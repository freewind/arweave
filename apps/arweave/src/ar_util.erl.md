# 文件功能和目的
该文件 `ar_util.erl` 是一个 Erlang 模块，提供了多种实用函数，用于处理布尔值、整数、二进制数据、时间戳、网络地址、列表操作、并行计算、文件读取等。这些函数主要用于辅助 Arweave 区块链项目的开发和维护。

# 主要逻辑
1. **数据类型转换**：包括布尔值与整数的相互转换、整数与二进制的相互转换（支持特殊值 `infinity`）。
2. **数值处理**：提供了向上取整和向下取整的函数，以及限制数值在指定范围内的函数。
3. **随机选择**：从列表中随机选择元素或子列表。
4. **编码与解码**：提供了 URL 安全的 Base64 编码和解码功能，并增加了安全版本的解码函数。
5. **时间处理**：将 Erlang 时间戳转换为 Unix 时间戳。
6. **网络地址处理**：解析和格式化网络地址，支持多种输入格式。
7. **列表操作**：提供了列表去重、计数、并行映射和过滤等功能。
8. **文件处理**：读取 CSV 文件生成创世钱包列表，检查文件是否存在且可读。
9. **其他实用函数**：包括字节数转换为 MiB 字符串、列表索引编码与解码、定时任务、安全除法、终端清屏、打印堆栈跟踪等。

# 关键点
- **数据类型转换**：`bool_to_int/1` 和 `int_to_bool/1` 用于布尔值和整数的相互转换。
- **数值处理**：`ceil_int/2` 和 `floor_int/2` 用于向上和向下取整。
- **随机选择**：`pick_random/1` 和 `pick_random/2` 用于从列表中随机选择元素。
- **编码与解码**：`encode/1` 和 `decode/1` 用于 Base64 编码和解码，`safe_decode/1` 增加了错误处理。
- **时间处理**：`timestamp_to_seconds/1` 将 Erlang 时间戳转换为 Unix 时间戳。
- **网络地址处理**：`parse_peer/1` 和 `format_peer/1` 用于解析和格式化网络地址。
- **列表操作**：`unique/1` 用于列表去重，`pmap/2` 和 `pfilter/2` 用于并行映射和过滤。
- **文件处理**：`genesis_wallets/0` 读取 CSV 文件生成创世钱包列表，`assert_file_exists_and_readable/1` 检查文件是否存在且可读。
- **其他实用函数**：`bytes_to_mb_string/1` 将字节数转换为 MiB 字符串，`cast_after/3` 用于定时任务，`terminal_clear/0` 用于清屏，`print_stacktrace/0` 用于打印堆栈跟踪。

# 潜在的坑
- **编码与解码**：`safe_decode/1` 虽然增加了错误处理，但仍然可能抛出异常，需要在使用时注意捕获。
- **网络地址处理**：`parse_peer/1` 和 `safe_parse_peer/1` 在解析失败时会抛出异常或返回错误，需要在使用时进行错误处理。
- **并行计算**：`pmap/2` 和 `pfilter/2` 使用了并行计算，可能会导致资源消耗过大，特别是在处理大列表时。
- **文件处理**：`genesis_wallets/0` 依赖于外部文件 `data/genesis_wallets.csv`，如果文件不存在或格式不正确，会导致函数失败。
- **定时任务**：`cast_after/3` 使用了 `erlang:send_after/3`，需要注意消息的发送对象和消息内容。

# 隐藏信息
- **编码与解码**：`encode/1` 和 `decode/1` 使用了 `b64fast` 模块，但没有在文件中明确说明其依赖关系。
- **并行计算**：`pmap/2` 和 `pfilter/2` 的实现细节没有完全暴露，特别是如何处理并行任务的返回结果。
- **文件处理**：`genesis_wallets/0` 假设 CSV 文件的格式是固定的，但没有在代码中明确说明。

# 假设前提
- **依赖模块**：假设 `b64fast` 模块已经存在并且可以正常使用。
- **文件路径**：假设 `data/genesis_wallets.csv` 文件存在于正确的路径下。
- **网络地址格式**：假设输入的网络地址格式是标准化的，且 `inet:getaddr/2` 可以正常解析。
- **Erlang 版本**：假设运行环境是 Erlang/OTP 21 或更高版本，因为 `print_stacktrace/0` 使用了新的堆栈跟踪获取方式。

# 历史背景
- **Arweave 项目**：该模块是为 Arweave 区块链项目开发的实用工具模块，用于处理项目中的各种数据和操作。
- **Erlang 生态**：Erlang 是一种函数式编程语言，广泛用于构建高并发、分布式系统，该模块充分利用了 Erlang 的并发和分布式特性。

# 数学或算法原理
- **向上取整和向下取整**：`ceil_int/2` 和 `floor_int/2` 使用了简单的数学运算来实现取整功能。
- **列表索引编码与解码**：`encode_list_indices/1` 和 `parse_list_indices/1` 使用了位操作来编码和解码列表索引，这是一种高效的压缩方法。
- **并行计算**：`pmap/2` 和 `pfilter/2` 使用了 Erlang 的并发特性，通过 `spawn_link/1` 和 `receive` 实现并行计算。